<div class="dashboard-container">
  <!-- Main Dashboard Window -->
  <div class="dashboard-window">
    <div class="dashboard-titlebar">
      <div class="dashboard-title">{{ currentUser?.username }}'s Dashboard</div>
      <div class="title-controls">
        <button class="win-button win-minimize" title="Minimize">_</button>
        <button class="win-button win-maximize" title="Maximize">‚ñ°</button>
        <button class="win-button win-close" (click)="onCloseWindow()" title="Close">‚úï</button>
      </div>
    </div>

    <div class="dashboard-body">
      <!-- Status Messages -->
      <div *ngIf="success" class="message-bar success">
        <span class="status-indicator success"></span>
        {{ success }}
        <button class="close-msg" (click)="clearMessages()">√ó</button>
      </div>
      
      <div *ngIf="error" class="message-bar error">
        <span class="status-indicator error"></span>
        {{ error }}
        <button class="close-msg" (click)="clearMessages()">√ó</button>
      </div>

      <!-- Toolbar -->
      <div class="toolbar">
        <div class="toolbar-section">
          <button class="toolbar-btn" (click)="onNewPost()" [disabled]="loading">
            üìù New Post
          </button>
          <button class="toolbar-btn" (click)="loadPosts()" [disabled]="loading">
            üîÑ Refresh
          </button>
        </div>
        
        <div class="toolbar-section">
          <span class="user-info">
            <span class="status-indicator"></span>
            Logged in as: <strong>{{ currentUser?.username }}</strong>
          </span>
          <button class="toolbar-btn logout-btn" (click)="onLogout()">
             Logout
          </button>
        </div>
      </div>

      <!-- Posts List -->
      <div class="posts-container">
        <div class="posts-header">
          <h3>Your Anecdotes ({{ posts.length }})</h3>
        </div>

        <div *ngIf="loading" class="loading-section">
          <span class="loading-text">Loading posts<span class="loading-dots"></span></span>
        </div>

        <div *ngIf="!loading && posts.length === 0" class="empty-state">
          <div class="empty-icon">üìù</div>
          <h4>No anecdotes yet</h4>
          <p>Click "New Post" to create your first anecdote!</p>
        </div>

        <div class="posts-list" *ngIf="!loading && posts.length > 0">
          <div class="post-item" *ngFor="let post of posts; trackBy: trackByPostId">
            <div class="post-header">
              <div class="post-title">{{ post.title }}</div>
              <div class="post-controls">
                <button class="post-btn" (click)="onEditPost(post)" title="Edit">
                  ‚úèÔ∏è
                </button>
                <button class="post-btn delete-btn" (click)="onDeletePost(post)" title="Delete">
                  üóëÔ∏è
                </button>
              </div>
            </div>
            <div class="post-content">{{ post.content }}</div>
            <div class="post-footer">
              <span class="post-date">Created: {{ formatDate(post.createdAt) }}</span>
              <span class="post-updated" *ngIf="post.updatedAt !== post.createdAt">
                Updated: {{ formatDate(post.updatedAt) }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- New Post Dialog -->
  <div class="dialog-overlay" *ngIf="showNewPostDialog" (click)="onCancelNewPost()">
    <div class="dialog-window" (click)="$event.stopPropagation()">
      <div class="dialog-titlebar">
        <div class="dialog-title">New Anecdote</div>
        <div class="title-controls">
          <button class="win-button win-close" (click)="onCancelNewPost()">‚úï</button>
        </div>
      </div>
      
      <div class="dialog-body">
        <form (ngSubmit)="onCreatePost()">
          <div class="input-group">
            <label for="newTitle">Title:</label>
            <input 
              type="text" 
              [(ngModel)]="newPostTitle" 
              name="newTitle"
              placeholder="Enter anecdote title"
              required
              [disabled]="creatingPost">
          </div>
          
          <div class="input-group">
            <label for="newContent">Story:</label>
            <textarea 
              [(ngModel)]="newPostContent" 
              name="newContent"
              placeholder="Tell your anecdote..."
              rows="8"
              required
              [disabled]="creatingPost">
            </textarea>
          </div>
          
          <div class="dialog-buttons">
            <button type="submit" [disabled]="creatingPost">
              <span *ngIf="!creatingPost">Create Post</span>
              <span *ngIf="creatingPost" class="loading-text">
                Creating<span class="loading-dots"></span>
              </span>
            </button>
            <button type="button" (click)="onCancelNewPost()" [disabled]="creatingPost">
              Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Post Dialog -->
  <div class="dialog-overlay" *ngIf="editingPost" (click)="onCancelEdit()">
    <div class="dialog-window" (click)="$event.stopPropagation()">
      <div class="dialog-titlebar">
        <div class="dialog-title">Edit Anecdote</div>
        <div class="title-controls">
          <button class="win-button win-close" (click)="onCancelEdit()">‚úï</button>
        </div>
      </div>
      
      <div class="dialog-body">
        <form (ngSubmit)="onSaveEdit()">
          <div class="input-group">
            <label for="editTitle">Title:</label>
            <input 
              type="text" 
              [(ngModel)]="editTitle" 
              name="editTitle"
              required>
          </div>
          
          <div class="input-group">
            <label for="editContent">Story:</label>
            <textarea 
              [(ngModel)]="editContent" 
              name="editContent"
              rows="8"
              required>
            </textarea>
          </div>
          
          <div class="dialog-buttons">
            <button type="submit">Save Changes</button>
            <button type="button" (click)="onCancelEdit()">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>